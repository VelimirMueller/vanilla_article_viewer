<!DOCTYPE html>
<html lang="de">
<head>
  <!-- meta -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="HTML, CSS, JavaScript, Bewerbung, Velimir, Müller, 3PC, Vanilla JS, Artikel, Barrierefreiheit, Performance, Webanwendung, Clean Code">
  <meta name="description" content="3PC Probearbeit von Author: Velimir Müller | 2024 | MIT License.">
  <title>3PC Probearbeit von Velimir Müller</title>

  <!-- styles and fonts -->
  <link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
  <!-- template content -->
  <main role="main">
    <section id="articles">
      <div class="template__container">
        <!-- content here -->
        <button 
          id="article-show-button" 
          class="btn btn__article--display-menu" 
          type="button"
          aria-label="Zeige alle Artikel"
          aria-controls="overlay">
            Alle Kategorien
        </button>
        <!-- overlay wrapper -->
        <div 
          id="overlay"
          class="template__overlay" >
          <div  
            class="template__overlay--wrapper">
            <button
              id="article-close-button" 
              type="button"
              tabindex="1"
              aria-controls="overlay"
              aria-label="Artikelmenü schließen"
              class="btn btn__close font-xl margin-left-auto font-xl-bold margin-bot-sm square-45px">
              X
            </button>
            <!-- articles content -->
            <div class="template__overlay--content">
              <aside
                id="articles-menu" 
                class="template__overlay--articles-menu">
                <div 
                  id="article-button-container"
                  role="menu"
                  class="template__overlay--button-list">
                  <!-- create buttons with event listeners dynamically and render them here -->
                  <!-- 
                    I decided to create the buttons dynamically instead of writing direct markup for them
                    I did not want to sacrifice the developer experience for it since I was pretty sure the 
                    performance will still be good if all the buttons will be created in the memory as fragments 
                    first, and added directly to the DOM after that with only 1 DOM update.
                  -->
                </div>
              </aside>
              <article 
                id="displayed-article"
                class="template__overlay--article">
                <div class="padding-article">
                  <h1
                    id="article-headline"
                    class="text__article--article-headline">
                    <!-- dynamic article headline content will override placeholder -->
                      Bitte Artikel auswählen.
                  </h1>
                  <hr>
                  <p 
                    id="article-paragraph" 
                    class="text__article--article-paragraph scroller">
                    <!-- dynamic article paragraph content will override placeholder -->
                  </p>
                </div>
              </article>
             </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 
    Javascript as module to keep the project structure tidy.
    Since the lighthouse performance tests was already at 100%,
    there was no need to further improve the performance by writing 
    all javascript directly in the `index.hmtl` instead of separated
    files.
  -->
  <script type="module" defer>
  import { 
    addArticleButtonEventListeners,
    closeOnEscape,
    createArticleButtons,

    fetchArticles,
    handleAriaStates,
    handleOverlay,
    preventHiddenShowButtonToBeFocused
  } from './js/index.js'

  // fetch articles
  const articlesData = await fetchArticles()
  
  // initializes handleOverlay
  const overlayHandler = handleOverlay()
  
  const showButton = document.getElementById('article-show-button')
  const closeButton = document.getElementById('article-close-button')

  // Set dynamic aria attributes when the overlay is shown
  const showAttributes = [
    { component: showButton, attributes: [{ ariaAttr:  'aria-pressed', ariaValue: 'false' }, { ariaAttr: 'aria-inert', ariaValue: 'false' }] },
    { component: closeButton, attributes: [{ ariaAttr:  'aria-pressed', ariaValue: 'false' }] }
  ]
  
  // Set dynamic aria attributes when the overlay is hidden
  const hideAttributes = [
    { component: showButton, attributes: [{ ariaAttr:  'aria-pressed', ariaValue: 'true' }, { ariaAttr: 'aria-inert', ariaValue: 'true' }] },
    { component: closeButton, attributes: [{ ariaAttr:  'aria-pressed', ariaValue: 'true' }] }
  ]

  // Handle dynamic aria attributes for close and show button
  handleAriaStates(overlayHandler, showButton, showAttributes)
  handleAriaStates(overlayHandler, closeButton, hideAttributes)

  // create buttons and add them to DOM (just one DOM update for all buttons)
  createArticleButtons('article-button-container', articlesData.articles, 'btn btn__secondary btn__secondary--article text__underline--hover')

  // Add event based logic to article buttons
  addArticleButtonEventListeners('btn__secondary--article', articlesData.articles, 'article-headline', 'article-paragraph')

  // makes article show button not focusable and focus first article button when overlay is shown
  const firstArticleButton = document.getElementsByClassName('btn__secondary--article')[0]
  preventHiddenShowButtonToBeFocused(overlayHandler, showButton, firstArticleButton)
  closeOnEscape(closeButton)
  </script>
</body>
</html>
